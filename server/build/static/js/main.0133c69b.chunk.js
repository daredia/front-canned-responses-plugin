(this["webpackJsonpfront-companion"]=this["webpackJsonpfront-companion"]||[]).push([[0],{43:function(e,t,a){e.exports=a(60)},59:function(e,t,a){},60:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),l=a(36),r=a.n(l),o=a(9),i=a(26),u=a(37),s=Object(n.createContext)(null),m=function(){return Object(n.useContext)(s).state},d=function(e,t){return console.log(t,t.value),"secret_set"===t.type?Object(i.a)({},e,{secret:t.value}):"airtable_credentials_set"===t.type?Object(i.a)({},e,{airtableKey:t.value.airtable_key,airtableBase:t.value.airtable_base}):"new_context_received"===t.type?Object(i.a)({},e,{frontContext:t.value}):e},v=function(e){var t=e.children,a=Object(n.useReducer)(d,null),l=Object(o.a)(a,2),r=l[0],i=l[1];Object(n.useEffect)((function(){var e=new URL(document.location.href).searchParams.get("auth_secret");console.log("Secret is ".concat(e)),i({type:"secret_set",value:e});var t=new URL(document.location.href).searchParams.get("airtable_key"),a=new URL(document.location.href).searchParams.get("airtable_base");t&&a&&i({type:"airtable_credentials_set",value:{airtable_key:t,airtable_base:a}});var n=u.contextUpdates.subscribe((function(e){return i({type:"new_context_received",value:e})}));return function(){return n.unsubscribe()}}),[]);var m=Object(n.useMemo)((function(){return{state:r,dispatch:i}}),[r,i]);return(null===r||void 0===r?void 0:r.frontContext)?c.a.createElement(s.Provider,{value:m},t):null},f=a(25),b=a(41),E=a(2),p=function(e){var t=e.label,a=e.href,n=m().frontContext.openUrl;return c.a.createElement("a",{onClick:function(e){e.preventDefault(),n(a)},href:a},t)},h=function(e){var t=e.label,a=e.to,n=m().frontContext.createDraft;return c.a.createElement("button",{className:"front-compose",onClick:function(){return n({to:[a]})}},t)},y=a(39),N=function(e){var t=e.value,a=y.DateTime.fromISO(t);return a.invalid?c.a.createElement("em",null,"Invalid date"):a.toFormat("D")},j=function(e){var t=e.value,a=Number(t),n=a<1e3?a.toFixed(0):a<1e6?"".concat(Math.round(a/10)/100,"k"):"".concat(Math.round(a/1e4)/100,"m");return c.a.createElement("span",null,"$",n)},O=function(e){var t=e.value;return c.a.createElement("span",{className:"data-badge"},t)},g=function(e){var t=e.type,a=e.value;return"date"===t?c.a.createElement(N,{value:a}):"badge"===t?c.a.createElement(O,{value:a}):"currency"===t?c.a.createElement(j,{value:a}):"list"===t&&a.length>0?c.a.createElement(c.a.Fragment,null,a.join(", ")):c.a.createElement(c.a.Fragment,null,a)},_=function(e){var t,a,l,r,i,u=e.contactKey,s=m(),d=s.secret,v=s.airtableKey,f=s.airtableBase,b=Object(n.useState)(!0),E=Object(o.a)(b,2),y=E[0],N=E[1],j=Object(n.useState)({}),O=Object(o.a)(j,2),_=O[0],C=O[1],k=Object(n.useState)(null),x=Object(o.a)(k,2),w=x[0],F=x[1];return Object(n.useEffect)((function(){if(_.contactKey!==u){var e="/api/search?auth_secret=".concat(d,"&contact_key=").concat(encodeURIComponent(u)),t=v&&f?"&airtable_key=".concat(v,"&airtable_base=").concat(f):"",a={contactKey:u};N(!0),F(null),fetch("".concat(e).concat(t),{method:"GET",mode:"cors"}).then((function(e){if(!e.ok&&404!==e.status)throw Error(e.statusText);return 404===e.status?{}:e.json()})).then((function(e){return C(Object.assign(a,e.data))})).catch((function(e){C(a),F(e.message)})).finally((function(){return N(!1)}))}}),[_,u,d,v,f]),y?c.a.createElement("div",{className:"notice"},"Loading..."):w?c.a.createElement("div",{className:"notice error"},w):_&&_.contact?c.a.createElement("div",{className:"info"},c.a.createElement("div",{className:"info-card"},c.a.createElement("div",{className:"info-card-contact"},null===(t=_.contact)||void 0===t?void 0:t.name),c.a.createElement("div",null,c.a.createElement(h,{to:null===(a=_.contact)||void 0===a?void 0:a.email,label:null===(l=_.contact)||void 0===l?void 0:l.email})),_.account?c.a.createElement("div",{className:"info-card-account"},c.a.createElement(p,{href:_.account.url,label:_.account.name})):void 0),c.a.createElement("div",{className:"info-contact"},(null===(r=_.contact)||void 0===r?void 0:r.data)?c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"data-title"},"Contact info"),c.a.createElement("ul",{className:"list-data"},_.contact.data.map((function(e,t){return c.a.createElement("li",{key:t},c.a.createElement("div",{className:"info-entry"},c.a.createElement("div",{className:"info-label"},e.label),c.a.createElement("div",{className:"info-value"},c.a.createElement(g,{type:e.type,value:e.value}))))})))):void 0),c.a.createElement("div",{className:"info-account"},(null===(i=_.account)||void 0===i?void 0:i.data)?c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"data-title"},"Account info"),c.a.createElement("ul",{className:"list-data"},_.account.data.map((function(e,t){return c.a.createElement("li",{key:t},c.a.createElement("div",{className:"info-entry"},c.a.createElement("div",{className:"info-label"},e.label),c.a.createElement("div",{className:"info-value"},c.a.createElement(g,{type:e.type,value:e.value}))))})))):void 0)):c.a.createElement("div",{className:"notice"},"No record found.")},C=function(e){var t=e.contacts,a=e.currentContact,n=e.setContact;return a?c.a.createElement("div",{className:"select-container"},c.a.createElement("select",{className:"select-contact",value:a,onChange:function(e){return n(e.target.value)}},t.map((function(e){return c.a.createElement("option",{key:e},e)}))),c.a.createElement("i",{className:"chevron-down"},"\u2304")):c.a.createElement(c.a.Fragment,null)},k=function(){var e=Object(n.useState)([]),t=Object(o.a)(e,2),a=t[0],l=t[1],r=m().frontContext,i=r.type,u=r.conversation,s=Object(n.useState)(null),d=Object(o.a)(s,2),v=d[0],p=d[1];return Object(n.useEffect)((function(){r.listMessages&&r.listMessages().then((function(e){var t,a=e.results.map((function(e){var t,a,n;return[].concat(Object(f.a)(e.to.map((function(e){return e.handle}))),[null===(t=e.from)||void 0===t?void 0:t.handle],Object(f.a)((null===(a=e.cc)||void 0===a?void 0:a.map((function(e){return e.handle})))||[]),Object(f.a)((null===(n=e.bcc)||void 0===n?void 0:n.map((function(e){return e.handle})))||[]))})).flat().filter((function(e,t,a){return a.indexOf(e)===t}));p(null===u||void 0===u||null===(t=u.recipient)||void 0===t?void 0:t.handle),l(a)}))}),[r,u]),c.a.createElement("div",{className:"app"},c.a.createElement(b.a,{basename:""},c.a.createElement(E.c,null,c.a.createElement(E.a,{path:"/"},"singleConversation"===i&&v?c.a.createElement(c.a.Fragment,null,c.a.createElement(C,{contacts:a,currentContact:v,setContact:p}),c.a.createElement(_,{contactKey:v})):c.a.createElement("div",{className:"notice"},"This plugin only works with conversations.")))))};a(59),t.default=k;r.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(v,null,c.a.createElement(k,null))),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.0133c69b.chunk.js.map